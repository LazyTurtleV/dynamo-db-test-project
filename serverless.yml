plugins:
  - serverless-dynamodb-local
  - serverless-offline

custom:
  serverless-offline:
    noPrependStageInUrl: true
  dynamodb:
    stages:
      - dev
    start:
      port: 8000
      migrate: true

service: comments-cloud

frameworkVersion: ">=1.1.0"

provider:
  name: aws
  runtime: nodejs12.x
  stage: dev
  region: us-east-1
  environment:
    TABLE_NAME: CommentsTable
    PROJECT_CONFIGURATION: DEV

functions:
  createComment:
    name: db-create-comment
    handler: API/handler.addComment
    events:
      - http:
          path: /comments/create
          method: post
  getComment:
    name: db-get-comment
    handler: API/handler.getComment
    events:
      - http:
          path: /comments/get-one
          method: post
  getComments:
    name: db-get-multiple-comments
    handler: API/handler.getComments
    events:
      - http:
          path: /comments/get-multiple
          method: post
  
resources:
  Resources:
    CommentsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: CommentsTable
        AttributeDefinitions:
          -
            AttributeName: comment_id
            AttributeType: S
          -
            AttributeName: comment_target
            AttributeType: S
        KeySchema:
          - 
            AttributeName: comment_target
            KeyType: HASH
          -
            AttributeName: comment_id
            KeyType: RANGE
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1

            
          
  